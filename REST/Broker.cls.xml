<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="REST.Broker">
<Description><![CDATA[
*******************************************************
использованы материалы с мероприятия
some part of this source code getting from
InterSystems Global Summit 2013 
"Building Mobile Applications with RESTful Interfaces" 
by Chris Carmichael and Oliver Caudron
*******************************************************
Также использован код из проекта
https://github.com/MDevelopmentGroup/Recruting
*******************************************************
После компиляции работает по адресу
<a href = "http://localhost:57772/rest/test">http://localhost:57772/rest/test</a>]]></Description>
<Super>%CSP.REST</Super>
<TimeCreated>62999,56505.766013</TimeCreated>

<XData name="UrlMap">
<Data><![CDATA[
<Routes>

   <Route Url="/terms/:query" Method="GET" Call="REST.Broker:LoadTermsPage"/>
   <Route Url="/terms" Method="GET" Call="REST.Broker:LoadTermsPageNoQuery"/>
   <Route Url="/terms/" Method="GET" Call="REST.Broker:LoadTermsPageNoQuery"/>
   <Route Url="/about" Method="GET" Call="csp.about:OnPage"/>
   <Route Url="/term/:id" Method="GET" Call="REST.Broker:LoadTermPage"/>

   <Route Url="/json/terms" Method="GET" Call="REST.JSON:GetAllTerms"/>
   <Route Url="/json/term/:termid" Method="GET" Call="REST.JSON:GetTerm"/>
   <Route Url="/json/term" Method="POST" Call="REST.JSON:AddUserTerm"/>
    
   <Route Url="/json/translation" Method="POST" Call="REST.JSON:AddTranslation"/>
   <Route Url="/json/translation/:termid" Method="GET" Call="REST.JSON:GetTranslations"/> 
   
   <Route Url="/json/user" Method="POST" Call="REST.JSON:AddUser"/>
   <Route Url="/json/user/:login/:password" Method="GET" Call="REST.JSON:LoginUser"/>
   <Route Url="/json/user/:email" Method="POST" Call="REST.JSON:SendNewPassword"/>
      
   <Route Url="/json/session/:login/:password" Method="GET" Call="REST.JSON:StartSession"/>
   
   <Route Url="/json/comment/:termid" Method="GET" Call="REST.JSON:GetComments"/>
   <Route Url="/json/comment/:termid" Method="POST" Call="REST.JSON:AddComment"/>
    
   <Route Url="/json/users" Method="GET" Call="REST.JSON:GetAllUsers"/>
   <Route Url="/json/user_comment/:userid" Method="GET" Call="REST.JSON:GetCommentsByUser"/>
   <Route Url="/json/user_translation/:userid" Method="GET" Call="REST.JSON:GetTranslationsByUser"/>
   
   <Route Url="/json/letter" Method="POST" Call="REST.JSON:AddLetter"/>

   <Route Url="/test" Method="GET" Call="REST.Broker:Test"/>  
 </Routes>
]]></Data>
</XData>

<Method name="Test">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	&html<<h1>Работает?!</h1>>
	&html<<h1>Работает!!!</h1>>
	quit $$$OK
]]></Implementation>
</Method>

<Method name="LoadTermsPage">
<Description>
Serves client csp.rest1 page</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>query:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[

	Set %request.Data("query",1)="'"_$ZCONVERT($ZCONVERT(query ,"I","URL") ,"I","UTF8")_"'"
<<<<<<< HEAD
	Set ^Statistics("Terms")=$INCREMENT(^Statistics("Terms"))
	Set ^Statistics($ZDATE($NOW(),4))=$INCREMENT(^Statistics($ZDATE($NOW(),4)))
	Do ##class(csp.rest1).OnPage()
	quit $$$OK
]]></Implementation>
</Method>

<Method name="LoadTermsPageNoQuery">
<Description>
Serves client csp.rest1 page without query</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Set ^Statistics("Terms")=$INCREMENT(^Statistics("Terms"))
	Set ^Statistics($ZDATE($NOW(),4))=$INCREMENT(^Statistics($ZDATE($NOW(),4)))
=======
>>>>>>> 1a16d8b8bf821e697d43b71ace2f8f5a4d92f1b1
	Do ##class(csp.rest1).OnPage()
	quit $$$OK
]]></Implementation>
</Method>

<Method name="LoadTermPage">
<ClassMethod>1</ClassMethod>
<FormalSpec>id:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Set %request.Data("id",1)=id
	Set ^Statistics(id)=$INCREMENT(^Statistics(id))
	Set ^Statistics($ZDATE($NOW(),4))=$INCREMENT(^Statistics($ZDATE($NOW(),4)))
	Do ##class(csp.term).OnPage()
	quit $$$OK
]]></Implementation>
</Method>

<Method name="Http404">
<Description>
404 page</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	do ##class(REST.Broker).LoadTermsPageNoQuery()
	//&html<<h1>Не Работает?!</h1>>
	quit $$$OK
]]></Implementation>
</Method>
</Class>
</Export>
